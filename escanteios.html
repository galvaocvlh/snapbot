<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analisador Universal de Escanteios</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark light; }
  </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen">
  <div class="max-w-4xl mx-auto p-6 space-y-6">
    <header>
      <h1 class="text-2xl font-bold">Analisador Universal de Escanteios</h1>
      <p class="text-zinc-400 mt-1">
        Cole o bloco bruto do Flashscore (últimos jogos de dois times).<br>
        O script calcula a <strong>média de escanteios</strong> de cada time detectado e a <strong>soma das médias</strong>.
      </p>
    </header>

    <!-- Entrada -->
    <section class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4 space-y-3">
      <h2 class="font-semibold">Entrada</h2>
      <textarea id="taUnified" rows="18" placeholder="Cole aqui o conteúdo bruto do Flashscore" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-sm"></textarea>
    </section>

    <!-- Botões -->
    <div class="flex items-center gap-3">
      <button id="btnAnalyze" class="px-4 py-2 rounded-xl bg-white text-black font-semibold hover:opacity-90 transition">Analisar</button>
      <button id="btnClear" class="px-4 py-2 rounded-xl bg-zinc-800 text-zinc-100 hover:bg-zinc-700 transition">Limpar</button>
    </div>

    <!-- Resultados -->
    <section id="results" class="hidden grid md:grid-cols-2 gap-4"></section>
    <section id="total" class="hidden bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4"></section>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // Parser: detecta linha de placar e pega time acima/abaixo
    function parseMatches(lines){
      const rxScore = /^(\d+)\s*[-:]\s*(\d+)$/;
      const out = [];
      for (let i=0; i<lines.length; i++){
        const m = lines[i].match(rxScore);
        if (m && i>0 && i<lines.length-1){
          out.push({
            timeA: lines[i-1].trim(),
            golsA: parseInt(m[1],10),
            golsB: parseInt(m[2],10),
            timeB: lines[i+1].trim(),
          });
        }
      }
      return out;
    }

    // Calcula média de escanteios do time alvo
    function cornerAvgFrom(matches, teamName) {
      let soma = 0, n = 0;
      for (const m of matches) {
        if (m.timeA.includes(teamName)) {
          soma += m.golsA; n++;
        } else if (m.timeB.includes(teamName)) {
          soma += m.golsB; n++;
        }
      }
      return n ? (soma/n) : null;
    }

    function analyze(){
      const raw = $("taUnified").value || "";
      const lines = raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);

      // Encontrar blocos "Resultados recentes do X"
      let blocos = {};
      for (let i=0; i<lines.length; i++){
        if (lines[i].includes("Resultados recentes")) {
          const nomeTime = lines[i-1]?.trim() || `Time${i}`;
          // pega tudo até o próximo "Resultados recentes" ou fim
          let j = i+1;
          while(j < lines.length && !lines[j].includes("Resultados recentes")) j++;
          blocos[nomeTime] = lines.slice(i+1, j);
        }
      }

      let cards = "";
      let medias = [];

      for (const time in blocos) {
        const jogos = parseMatches(blocos[time]);
        const media = cornerAvgFrom(jogos,time);
        if (media != null) {
          medias.push({time, media});
          cards += `
            <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4">
              <h3 class="font-semibold mb-2">${time}</h3>
              <p class="text-emerald-300">Média de escanteios: <b>${media.toFixed(2)}</b></p>
            </div>`;
        }
      }

      $("results").classList.remove('hidden');
      $("results").innerHTML = cards;

      // Soma das médias (apenas se tiver 2 times)
      if (medias.length === 2){
        const soma = (medias[0].media + medias[1].media).toFixed(2);
        $("total").classList.remove('hidden');
        $("total").innerHTML = `
          <h3 class="font-semibold mb-2">Soma das médias</h3>
          <p class="text-pink-300">${medias[0].time} (${medias[0].media.toFixed(2)}) + ${medias[1].time} (${medias[1].media.toFixed(2)}) = <b>${soma}</b></p>
        `;
      } else {
        $("total").classList.add('hidden');
        $("total").innerHTML = "";
      }
    }

    $("btnAnalyze").addEventListener('click', analyze);
    $("btnClear").addEventListener('click', () => {
      $("taUnified").value = '';
      $("results").classList.add('hidden');
      $("results").innerHTML = '';
      $("total").classList.add('hidden');
      $("total").innerHTML = '';
    });
  </script>
</body>
</html>
