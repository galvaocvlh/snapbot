<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analisador de Escanteios</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark light; }
    .badge { @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium; }
  </style>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen">

  <!-- Navbar fixa -->
  <nav class="fixed top-0 left-0 w-full bg-zinc-900/90 border-b border-zinc-800 backdrop-blur-md z-50">
    <div class="max-w-4xl mx-auto px-6 py-3 flex justify-center gap-6 font-semibold text-sm">
      <a href="index.html" class="hover:text-emerald-400 transition">Página Inicial</a>
      <a href="escanteios.html" class="hover:text-emerald-400 transition">Escanteios</a>
      <a href="gols.html" class="hover:text-emerald-400 transition">Gols</a>
    </div>
  </nav>

  <!-- Conteúdo -->
  <div class="max-w-4xl mx-auto p-6 space-y-6 pt-20">
    <header>
      <h1 class="text-2xl font-bold">Analisador de Escanteios</h1>
      <p class="text-zinc-400 mt-1">
        Cole o bloco bruto do Flashscore (com últimos jogos).<br>
        O script organiza e calcula a <strong>média de escanteios</strong> de cada time.
      </p>
    </header>

    <!-- Entrada -->
    <section class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4 space-y-3">
      <h2 class="font-semibold">Entrada</h2>
      <textarea id="taUnified" rows="18" placeholder="Cole aqui o conteúdo bruto do Flashscore" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-3 text-sm"></textarea>
    </section>

    <!-- Botões -->
    <div class="flex items-center gap-3">
      <button id="btnAnalyze" class="px-4 py-2 rounded-xl bg-white text-black font-semibold hover:opacity-90 transition">Analisar</button>
      <button id="btnClear" class="px-4 py-2 rounded-xl bg-zinc-800 text-zinc-100 hover:bg-zinc-700 transition">Limpar</button>
    </div>

    <!-- Resultados -->
    <section id="results" class="hidden grid md:grid-cols-2 gap-4">
      <div id="cardHome" class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4"></div>
      <div id="cardAway" class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-4"></div>
    </section>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // Parser: detecta linha de placar e pega time acima/abaixo
    function parseMatches(lines){
      const rxScore = /^(\d+)\s*[-:]\s*(\d+)$/;
      const out = [];
      for (let i=0; i<lines.length; i++){
        const m = lines[i].match(rxScore);
        if (m && i>0 && i<lines.length-1){
          out.push({
            timeA: lines[i-1].trim(),
            golsA: parseInt(m[1],10),
            golsB: parseInt(m[2],10),
            timeB: lines[i+1].trim(),
          });
        }
      }
      return out;
    }

    // Calcula média de escanteios do time alvo
    function cornerAvgFrom(matches, teamName) {
      let soma = 0, n = 0;
      for (const m of matches) {
        if (m.timeA.includes(teamName)) {
          soma += m.golsA; n++;
        } else if (m.timeB.includes(teamName)) {
          soma += m.golsB; n++;
        }
      }
      return n ? (soma/n).toFixed(2) : "—";
    }

    function analyze(){
      const raw = $("taUnified").value || "";
      const lines = raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);

      // Divide em blocos Santos / Grêmio
      const idxSantos = lines.findIndex(l => l.includes("Santos") && lines[lines.indexOf(l)+1]?.includes("Resultados recentes"));
      const idxGremio = lines.findIndex(l => l.includes("Grêmio") && lines[lines.indexOf(l)+1]?.includes("Resultados recentes"));

      const blocos = { santos: [], gremio: [] };
      if (idxSantos >= 0) {
        const start = idxSantos+2;
        const end = idxGremio >= 0 ? idxGremio : lines.length;
        blocos.santos = lines.slice(start,end);
      }
      if (idxGremio >= 0) {
        const start = idxGremio+2;
        blocos.gremio = lines.slice(start);
      }

      const jogosSantos = parseMatches(blocos.santos);
      const jogosGremio = parseMatches(blocos.gremio);

      const mediaSantos = cornerAvgFrom(jogosSantos,"Santos");
      const mediaGremio = cornerAvgFrom(jogosGremio,"Grêmio");

      $("results").classList.remove('hidden');
      $("cardHome").innerHTML = `
        <h3 class="font-semibold mb-2">Casa (Santos)</h3>
        <p class="text-emerald-300">Média de escanteios do Santos: <b>${mediaSantos}</b></p>
      `;
      $("cardAway").innerHTML = `
        <h3 class="font-semibold mb-2">Fora (Grêmio)</h3>
        <p class="text-sky-300">Média de escanteios do Grêmio: <b>${mediaGremio}</b></p>
      `;
    }

    $("btnAnalyze").addEventListener('click', analyze);
    $("btnClear").addEventListener('click', () => {
      $("taUnified").value = '';
      $("results").classList.add('hidden');
      $("cardHome").innerHTML = '';
      $("cardAway").innerHTML = '';
    });
  </script>
</body>
</html>
